<!--
  `admin-status`

  Displays the status of the current application

  User must be an administrator or an authorized user.

  Usage is simple:
  <admin-status></admin-status>

  It does not disploay a heading. If you want a haeder:
  <admin-status heading="Status"></admin-status>
-->
<dom-module id="admin-status">
  <template>
    <style include="iron-flex iron-flex-alignment nuxeo-styles">

    table {
      margin-left:  10px;
      margin-right:  15px;
      border-collapse: collapse;
    }

    tr {
      border: solid;
      border-width: 1px 0;
      border-color: lightgrey;
    }

    td {
      padding:  10px;
    }
    </style>

    <iron-ajax id="getRunningStatus"
               auto
               url="/nuxeo/runningstatus"
               method="GET"
               on-response="_getStatusResponse"
               on-error="_runningStatusCallFailure">
    </iron-ajax>

    <nuxeo-card heading="[[heading]]">
      <table>
        <template is="dom-repeat" items="[[statusResponse]]">
          <tr>
            <td>
              [[item.key]]
            </td>
            <td style="padding-left:15px">
              [[item.value]]
            </td>
          </tr>
        </template>
      </table>
    </nuxeo-card>

  </template>

  <script>
    Polymer({
      is: 'admin-status',
      behaviors: [Nuxeo.LayoutBehavior],
      properties: {
        heading: {
          type: String,
          value: ""
        },
        statusResponse: Object
      },

      _getStatusResponse: function(evt, req) {

        let statusResponse = [];

        // Format the response for the display
        Object.keys(evt.detail.response).forEach(function(key) {
          statusResponse.push({
            "key": this._formatStatusKey(key),
            "value": this._formatStatus(evt.detail.response[key])
          });
        }.bind(this));
        statusResponse.sort((a, b) => a.key.localeCompare(b.key));

        this.statusResponse = statusResponse;
      },

      _runningStatusCallFailure: function() {
        alert("Failed to get the runningStatus:\n\n" + evt.detail.error.stack);
      },

      _formatStatusKey: function(key) {

        key = key.replace("Status", "");

        switch(key) {
        case "elasticSearch":
          return "Elasticsearch";

        case "ldapDirectories":
          return "LDAP Directories";

        case "repository":
          return "Repository";
        
        case "runtime":
          return "Runtime";
        
        case "stream":
          return "Stream";
        }

        return key;
      },

      _formatStatus: function(status) {

        if(status === "ok") {
          return "ðŸŸ¢"
        }

        return "ðŸ”´";
      }

    });
  </script>
</dom-module>
